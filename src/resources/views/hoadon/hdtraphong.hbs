<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<div class="row">
  <!-- ====menu==== -->
  <div class="menu col l-3 m-0 c-0">

    <ul class="menu-nav l-3 m-0 c-0">
      <a href="http://localhost:3000/private">
                <img src="/img/logo.png" width="148px">
      </a>

    </ul>

    <ul class="main">
      <ul class="menu-ul">
        <li class="menu-ul_li">
          <a href="#">
            <i class="ti-home"></i>
            Danh mục


        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/dsdichvu">
            <i class="ti-receipt"></i>
            Danh mục dịch vụ
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/thucdonmonan">
            <i class="ti-bookmark-alt"></i>
            Danh mục món ăn
          </a>
        </li>

        
        </li>


        </a>
        </li>
        <li class="menu-ul_li">
          <a href="#">
            <i class="ti-user"></i>
            Khách hàng

        <li class="menu-ul_li-inside">
        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/khachhang">
            <i class="ti-id-badge"></i>
            Tạo hồ sơ khách hàng
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/dskhachhang">
            <i class="ti-cloud-down"></i>
            Danh sách khách hàng
          </a>
        </li>

        </li>

        </a>
        </li>
        
        <li class="menu-ul_li">
          <a href="#">
            <i class="ti-direction"></i>
            Phòng
        <li class="menu-ul_li-inside">
        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/datphong">
            <i class="ti-stamp"></i>
            Đặt phòng
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/doiphong">
            <i class="ti-layout-media-right"></i>
            Đổi phòng
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/giahan">
            <i class="ti-timer"></i>
            Gia hạn phòng
          </a>
        </li>

        

        </li>
        </a>
        </li>
        <li class="menu-ul_li">
          <a href="#">
            <i class="ti-clipboard"></i>
            Dịch vụ 
        <li class="menu-ul_li-inside">
        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/sudungdichvu">
            <i class="ti-layout-grid2"></i>
            Đặt dịch vụ
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/dattiec">
            <i class="ti-agenda"></i>
            Đặt tiệc
          </a>
        </li>

        </li>
        </a>
        </li>
        <li class="menu-ul_li">
          <a href="#">
            <i class="far fa-plus-square"></i>
            Tạo
        <li class="menu-ul_li-inside">
        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/dichvu">
            <i class="far fa-plus-square"></i>
            Tạo dịch vụ
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/themmonan ">
            <i class="far fa-plus-square"></i>
            Thêm món ăn
          </a>
        </li>

        </li>
        <li class="menu-ul_li">
          <a href="#">
            <i class="ti-face-smile"></i>
            Hóa đơn
        <li class="menu-ul_li-inside">
        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/traphong">
            <i class="ti-receipt"></i>
            Thanh toán phòng
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/hddichvu">
            <i class="ti-printer"></i>
            Thanh toán dịch vụ
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/hddattiecsearch">
            <i class="ti-rocket"></i>
            Thanh toán đặt tiệc
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/hdsuco">
            <i class="ti-money"></i>
            Thanh toán sự cố
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/hdtong">
            <i class="ti-printer"></i>
            Thanh toán tổng
          </a>
        </li>
        </li>
        </a>
        </li>
        <li class="menu-ul_li">
          <a href="#">
            <i class="ti-user"></i>
            Báo biểu

        <li class="menu-ul_li-inside">
        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/thongketheongay">
            <i class="ti-layout-grid2"></i>
            Thống kê khách theo ngày
          </a>
        </li>

        <li class="menu-ul_li-inside_li">
          <a class="menu-ul_li-inside_a" href="http://localhost:3000/private/thongketheothang">
            <i class="ti-agenda"></i>
            Thống kê khách theo tháng
          </a>
        </li>

        </li>
        </a>
        </li>
      </ul>

    </ul>


  </div>
  <!-- ====menu-end==== -->

  <!-- ====content==== -->
  <div class="menu col l-9 m-12 c-12">
    <nav class="content-nav">

      <ul class="l-3 content-nav_chuong_cachle1">
        <li>GonT</li>
      </ul>

      <ul class="l-8 m-0 c-0 content-nav_chuong_cachle">
        <li class="tro_giup content-nav_chuong">
          <i class="ti-help-alt"></i>
          Trợ Giúp
          <div class="header__notify-giup">
            <header class="header__notify-header-giup">
              <input type="text" placeholder="Nhập thông tin tìm kiếm tại đây">
            </header>
            <ul class="header__notify-list-giup">
              <li class="header__notify-item-giup header__notify-colorbackround-giup">
                <a href="" class="header__notify-link-giup">
                  - Hỗ trợ thiết bị bán hàng
                </a>
              </li>
            </ul>

            <ul class="header__notify-list-giup">
              <li class="header__notify-item-giup header__notify-colorbackround-giup">
                <a href="" class="header__notify-link-giup">
                  - Tài liệu hướng dẫn
                </a>
              </li>
            </ul>

            <ul class="header__notify-list-giup">
              <li class="header__notify-item-giup header__notify-colorbackround-giup">
                <a href="" class="header__notify-link-giup">
                  - Giao diện tổng quan
                </a>
              </li>
            </ul>

            <div class="header__notify-footer">
              <a href="" class="header__notify-footer-btn">
                <i class="fas fa-phone-alt"></i>
                0338091539
              </a>
              <a href="" class="header__notify-footer-btn">
                <i class="fas fa-envelope"></i>
                Gửi hỗ trợ
              </a>
            </div>
          </div>
        </li>
        <li class="js-buy-ticket content-nav_chuong">
          <i class="ti-heart"></i>
          Góp ý
        </li>
        <li class="info content-nav_chuong">

          <img src="/img/img_user.jpg" width="28px">
          NguyenPhucThanh
          <div class="for_info">
            <ul>
              <li>
                <a href="">
                  <i class="fas fa-user-circle"></i>
                  Tài khoản
                </a>
              </li>
              <li class="dich_vu">
                <a href="">
                  <i class="fas fa-concierge-bell"></i>
                  Gói dịch vụ
                </a>
              </li>
              <li>
                <a href="">
                  <i class="ti-book"></i>
                  Điều khoản dịch vụ
                </a>
              </li>
              <li>
                <a href="">
                  <i class="fas fa-shield-alt"></i>
                  Chính sách bảo mật
                </a>
              </li>
              <li>
                <a href="">
                  <i class="fas fa-headset"></i>
                  Hỗ Trợ
                </a>
              </li>
              <li class="dang_xuat">
                <a href="">
                  <i class="fas fa-sign-out-alt"></i>
                  Đăng xuất
                </a>
              </li>
            </ul>
        </li>
        <li class="bell content-nav_chuong">
          <i class="ti-bell"></i>
          <div class="header__notify">
            <header class="header__notify-header">
              <h3>Thông Báo Mới Nhận </h3>
            </header>
            <ul class="header__notify-list">
              <li class="header__notify-item header__notify-colorbackround">
                <a href="" class="header__notify-link">
                  <img src="/img/dichco.jpg" alt="" class="header__notify-img">
                  <div class="header__notify-info">
                    <span class="header__notify-name"> Cai nay là cái tên ở Trên</span>
                    <span class="header__notify-description"> Cai nay là cái tên ở Dưới</span>
                  </div>
                </a>
              </li>
            </ul>

            <ul class="header__notify-list">
              <li class="header__notify-item header__notify-colorbackround">
                <a href="" class="header__notify-link">
                  <img src="/img/dichco.jpg" alt="" class="header__notify-img">
                  <div class="header__notify-info">
                    <span class="header__notify-name"> Cai nay là cái tên ở Trên</span>
                    <span class="header__notify-description"> Cai nay là cái tên ở Dưới </span>
                  </div>
                </a>
              </li>
            </ul>

            <ul class="header__notify-list">
              <li class="header__notify-item   header__notify-colorbackround">
                <a href="" class="header__notify-link">
                  <img src="/img/dichco.jpg" alt="" class="header__notify-img">
                  <div class="header__notify-info">
                    <span class="header__notify-name"> Cai nay là cái tên ở Trên</span>
                    <span class="header__notify-description"> Cai nay là cái tên ở Duoi </span>
                  </div>
                </a>
              </li>
            </ul>

            <div class="header__notify-footer">
              <a href="" class="header__notify-footer-btn">
                Xem tất cả
              </a>
            </div>
          </div>
        </li>
      </ul>

    </nav>



    <!-- ===content__Phieu Dat Tiec==== -->
    <div class="content-container">
      <div class="tieu_de">
        <div class="tieu_de-text">
          Hóa đơn trả phòng
        </div>
        <div class="tieu_de-huong-dan">
    
          <a href="">
            <i class="fas fa-exclamation-circle"></i>
            Hướng dẫn
          </a>
        </div>
      </div>


      <div class="noi_dung-1">
        <div class="l-8 m-12 c-12">
          <div class="bang_lon ">
            <div class="noi_dung-1-text_name name_hd l-12 m-0 c-0">Thông tin hóa đơn</div>

            <div class="box_name">
              <div>
                <p>Công ty khách sạn:</p>
                <p>Địa chỉ:</p>
              </div>

              <div class="first">
                <p>GonT</p>
                <p>144A Chi Lăng Vũng Tàu</p>
              </div>
            </div>




            <div class="box">

              <div class="box-trong l-5">
                <div class="noi_dung-1-text_noi-dung">
                  <div class="noi_dung-1-text_noi-dung_hoten">CMND </div>
                  <p> (*)</p>
                </div>
                <p id="cmnd" name="cmnd"> </p>
              </div>

            </div>
            <div class="noi_dung-1-text_noi-dung">
              <div class="noi_dung-1-text_noi-dung_hoten">Họ tên</div>
              <p> (*)</p>
            </div>
            <p id="name" name="name"> </p>


            <table border="1" class="table_ds">
              <thead>
                <tr class="tr_ds">

                  <th scope="col">
                    #
                  </th>
                  <th scope="col"> Mã Phòng</th>
                  <th>Ngày đến </th>
                  <th scope="col">Ngày đi </th>
                  <th scope="col">Tạm ứng</th>
                  <th scope="col">Ngày ở</th>
                  <th scope="col">Đơn giá</th>
                  <th scope="col">Thanh toán</th>
                </tr>
              </thead>
              <tbody id="tb">

              </tbody>
            </table>

            <div class="box-trong l-5">
              <div class="noi_dung-1-text_noi-dung">
                <div class="noi_dung-1-text_noi-dung_hoten">Tổng tiền thanh toán</div>
                <p> (*)</p>
              </div>
              <div class="box-trong_om">
                <span class="box-trong_text" id="total"> </span>
              </div>
            </div>

          </div>

        </div>







      </div>



      <div class="bottom-nav">
        <button class="bottom-nav_huy">
          Hủy
        </button>

        <button class="bottom-nav_luu" id="save">
          Lưu
        </button>
      </div>
    </div>


  </div>
  <!-- ===content__Phieu Dat Tiec-end==== -->


</div>
<!-- ====content-end==== -->
</div>

<!-- ====content-end==== -->



</div>

<!-- ===Gop_Y=== -->
<div class="modal js-modal">
  <div class="modal-container js-modal-container">

    <div class="modal-close js-modal-close">
      <i class="ti-close"></i>
    </div>

    <div class="modal-header">
      Gửi góp ý
    </div>

    <div class="modal-body">
      <input id="quantity" type="text" class="modal-input" placeholder="Vui Lòng nhập góp ý của bạn vào đây !">

      <button class=modal-pay>
        Gửi
        <i class="ti-check"></i>
      </button>

      <div class="modal-footer">
        <p class="modal-help">
          Need
          <a href="">
            Help?
          </a>
        </p>
      </div>
    </div>
  </div>

</div>

<script>
  // dong/mo Modal
  const buyBtns = document.querySelectorAll('.js-buy-ticket');
  const modal = document.querySelector('.js-modal')
  const modalclose = document.querySelector('.js-modal-close')
  const modalcontainer = document.querySelector('.js-modal-container')

  function Showbuytickets() {
    modal.classList.add('open')
  }
  function hidebuyticket() {
    modal.classList.remove('open')
  }

  for (const buyBtn of buyBtns) {
    buyBtn.addEventListener('click', Showbuytickets)
  }

  modalclose.addEventListener('click', hidebuyticket)
  modal.addEventListener('click', hidebuyticket)
  modalcontainer.addEventListener('click', function (even) {
    even.stopPropagation()
  })
</script>
<!-- ===Gop_Y-end=== -->

<script>
  let searchParams = new URLSearchParams(window.location.search)
  let param = Number(searchParams.get('cmnd'))
  const dataBill = []
  $.ajax({
    url: 'http://localhost:3000/private/getAllTicket',
    type: 'POST',
    data: { cmnd: param },
    success: (data) => {
      $('#cmnd').text(`${data[0]['cmnd']}`)
      $('#name').text(`${data[0]['name']}`)
  
      data.forEach((el, index) => {
        
      
        $.ajax({
          url: 'http://localhost:3000/private/getIdRoom',
          type: 'POST',
          data: { id: el['Room'].idRoom },
          success: (room) => {
            let item = {
              countClick:0,
              check : false,
              idRoom: room[0]['name'],
              idRoomm: el['Room'].idRoom ,
              dateArrive: formatDay(new Date(el['dateArrive'])),
              dateGo: formatDay(new Date(el['dateGo'])),
              moneyPay: el['moneyPay'],
              dateIn:getDateDiff(formatDay(new Date(el['dateArrive'])), formatDay(new Date(el['dateGo']))),
              price: room[0]['price'],
              NeedPaid: (room[0]['price'] * getDateDiff(formatDay(new Date(el['dateArrive'])), formatDay(new Date(el['dateGo']))))-el['moneyPay']

            }
            
            
            dataBill.push(item)
          
            
            localStorage.setItem('bill',JSON.stringify(dataBill))

           
          }
         


        })
      
      
      
      })
      
      
    },
    error: (data) => {
      console.log(data)
    }
    
  })
  function formatDay(day) {
    var date = day.toJSON().slice(0, 10);
    var nDate = date.slice(8, 10) + '-'
      + date.slice(5, 7) + '-'
      + date.slice(0, 4);
    return nDate;
  }
  
  
</script>
<script>
  function getDateDiff(dateOne, dateTwo) {
        if(dateOne.charAt(2)=='-' & dateTwo.charAt(2)=='-'){
            dateOne = new Date(formatDate(dateOne));
            dateTwo = new Date(formatDate(dateTwo));
        }
        else{
            dateOne = new Date(dateOne);
            dateTwo = new Date(dateTwo);            
        }
        let timeDiff = Math.abs(dateOne.getTime() - dateTwo.getTime());
        let diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
        let diffMonths = Math.ceil(diffDays/31);
        let diffYears = Math.ceil(diffMonths/12);
 
        /*let message = "Difference in Days: " + diffDays + " " +
                      "Difference in Months: " + diffMonths+ " " + 
                      "Difference in Years: " + diffYears;
        return message;*/
        return diffDays
     }
 
    function formatDate(date) {
         return date.split('-').reverse().join('-');
    }
 
    //console.log(getDateDiff("23-04-2018", "25-04-2018"));
</script>
<script>
  const data = JSON.parse(localStorage.getItem('bill'));
  let total = 0
  data.forEach((el,index)=>{
     let tr = `
                 <tr class="tr_ds">

                                    <th scope="col">
                                        <input type="checkbox" onclick="update('${index}')">
                                    </th>
                                     <th> ${el['idRoom']}</th>
                                    <th>${el['dateArrive']}</th>
                                    <th>${el['dateGo']}</th>
                                    <th scope="col">${el['moneyPay'].toLocaleString('vi', {style : 'currency', currency : 'VND'})} </th>
                                    
                                    <th scope="col">${el['dateIn']}</th>
                                     <th scope="col">${el['price'].toLocaleString('vi', {style : 'currency', currency : 'VND'})}</th>
                                      <th scope="col">${el['NeedPaid'].toLocaleString('vi', {style : 'currency', currency : 'VND'})}</th>
                                </tr>
                
                `
            $('#tb').append(tr)
  })
  localStorage.setItem('total',JSON.stringify({'total':0}))
  function update(id){
    let total = JSON.parse(localStorage.getItem('total'))['total']
   
    const data = JSON.parse(localStorage.getItem('bill'));
    if(data[id]['countClick'] >0){
      data[id]['countClick'] = 0
      data[id]['check'] = false
      total -= Number(data[id]['NeedPaid'])
      localStorage.setItem('total',JSON.stringify({'total':total}))
      localStorage.setItem('bill',JSON.stringify(data))
    }
    else{

    
    data.forEach((el,index)=>{
      
      if(id==index){
        el['countClick']+=1
        el['check'] = true
        total += Number(el['NeedPaid'])
        localStorage.setItem('total',JSON.stringify({'total':total}))
        
      }
    })
    localStorage.setItem('bill',JSON.stringify(data))
    }
    
    
    //neu countClick = 0 la chua chon

    //neu >0 thi reset =0
    
  }
  setInterval(()=>{
    let total = JSON.parse(localStorage.getItem('total'))['total']
    
      $('#total').text(`${total.toLocaleString('vi', {style : 'currency', currency : 'VND'})}`)
    
  },150)

  

</script>
<script>
  //post data
  function getBillChecked(){
    databill = JSON.parse(localStorage.getItem('bill'))
    let billChecked = []
    databill.forEach(el=>{
      if(el['check']==true){
        billChecked.push(el)
        
      }
    })
    
    return billChecked
  }
  $('#save').click(()=>{
    const data = {
      cmnd: $('#cmnd').text() ,
      name: $('#name').text(), 
      //thong tin phieu thu => type array
      bill: getBillChecked(),
      //type number
      total: Number(JSON.parse(localStorage.getItem('total'))['total'])


    }
    $.ajax({
      //thong tin url dien vo nhe
      url: '/private/traphong',
      type: 'POST',
      data: data,
  
    })
    /*.then((res)=>{alert('Save successfully'); window.location.replace('/private');})
    .catch((res)=>{alert('Save error ')})*/
  })
  

</script>

